# 后台管理系统接口文档

本文档提供了后台管理系统的所有 RESTful API 接口的详细说明。

## 文档目录

1. [用户接口](./用户接口.md) - 用户管理相关接口

   - 创建用户
   - 查询用户列表
   - 查询单个用户
   - 更新用户
   - 删除用户

2. [角色接口](./角色接口.md) - 角色管理相关接口

   - 创建角色
   - 查询角色列表
   - 查询单个角色
   - 更新角色
   - 删除角色

3. [菜单接口](./菜单接口.md) - 菜单与权限管理相关接口
   - 菜单管理
     - 创建菜单
     - 查询菜单列表
     - 查询单个菜单
     - 更新菜单
     - 删除菜单
   - 权限管理
     - 创建权限
     - 查询权限列表
     - 查询单个权限
     - 更新权限
     - 删除权限

## 通用说明

### 接口规范

所有接口遵循 RESTful 设计规范：

- **GET**：获取资源
- **POST**：创建资源
- **PATCH**：更新资源
- **DELETE**：删除资源

### 响应格式

所有接口的响应格式均为 JSON，结构如下：

```json
{
  "code": 200000,
  "message": "操作成功",
  "data": {
    // 响应数据
  },
  "path": "/users",
  "timestamp": 1672574400000
}
```

其中：
- `code`: 状态码，由3位HTTP状态码和3位业务码组成
- `message`: 响应消息
- `data`: 响应数据
- `path`: 请求路径
- `timestamp`: 响应时间戳（Unix 秒时间戳）

### 成功响应

#### 成功响应示例

```json
{
  "code": 200000,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "admin",
    "name": "管理员",
    "createdAt": "2023-01-01T12:00:00.000Z"
  },
  "path": "/users/1",
  "timestamp": 1672574400
}
```

### 状态码说明

系统使用6位状态码，格式为XXXYYY：
- XXX: HTTP状态码
- YYY: 业务码（000表示无特定业务场景）

| 状态码 | 描述 |
| ------ | -------------- |
| 200000 | 操作成功 |
| 400000 | 通用业务逻辑错误 |
| 401000 | 未授权-需要重新登录 |
| 401001 | 访问令牌过期-可以通过刷新令牌重新获取 |
| 401002 | 访问令牌无效-需要重新登录 |
| 401003 | 刷新令牌过期-需要重新登录 |
| 401004 | 刷新令牌无效-需要重新登录 |
| 422000 | 参数错误 |
| 500000 | 服务器内部错误 |

### 响应处理机制

系统采用了全局响应拦截和异常处理机制：

1. **响应拦截器**：所有成功的响应都会被统一处理为标准格式，包含 code、message、data、path 和 timestamp 字段。
   
2. **异常过滤器**：捕获系统中抛出的各类异常，并转换为统一的错误响应格式。主要处理以下类型的异常：
   - 授权异常（AuthException）：返回对应的认证错误状态码和消息
   - 业务异常（BusinessException）：返回对应的业务错误状态码和消息
   - HTTP异常：返回相应的HTTP错误信息
   - 其他异常：统一作为内部服务器错误处理

### 认证方式

API 采用 JWT 认证，需认证后访问的接口，请求需要在请求头中包含 `Authorization` 字段：

```
Authorization: Bearer <token>
```

### 分页查询

系统支持标准的分页查询功能，用于获取列表数据。

#### 分页请求参数

分页查询通用参数：

| 参数名    | 类型   | 是否必须 | 描述                        |
| --------- | ------ | -------- | --------------------------- |
| page      | number | 否       | 页码，从1开始，默认为1      |
| pageSize  | number | 否       | 每页数量，默认为10          |
| sortBy    | string | 否       | 排序字段，指定排序的字段名称 |
| sortOrder | string | 否       | 排序方向，'ASC'升序或'DESC'降序 |

#### 分页响应格式

分页接口的响应数据结构：

```json
{
  "code": 200000,
  "message": "操作成功",
  "data": {
    "items": [
      // 列表数据项
    ],
    "total": 100,
    "page": 1,
    "pageSize": 10
  },
  "path": "/users",
  "timestamp": 1672574400
}
```

分页数据包含以下字段：
- `items`: 数据项列表，当前页的数据记录
- `total`: 总数据量，符合查询条件的总记录数
- `page`: 当前页码，从1开始
- `pageSize`: 每页数量，每页显示的记录数

### 接口文档书写模板

在编写新的接口文档时，请参考以下模板格式：

## 接口名称

> 简要描述接口的主要功能和用途

### 基本信息

- **接口URL**: `/资源路径`
- **请求方式**: `GET|POST|PATCH|DELETE`
- **认证要求**: 是/否
  - 是：使用 `JwtAuthGuard` 进行JWT认证
  - 否：无需认证
- **权限要求**: 无 或 指定所需权限

### 请求参数

#### 路径参数

| 参数名 | 类型   | 是否必须 | 描述         |
| ------ | ------ | -------- | ------------ |
| id     | number | 是       | 资源唯一标识 |

#### 查询参数

| 参数名     | 类型   | 是否必须 | 描述                   |
| ---------- | ------ | -------- | ---------------------- |
| keyword    | string | 否       | 搜索关键词             |
| status     | string | 否       | 状态过滤               |
| ... 分页参数 | ...    | ...      | 参考通用分页查询参数   |

#### 请求体 (JSON)

```json
{
  "field1": "值1",
  "field2": "值2",
  "nestedObject": {
    "subField1": "子值1"
  },
  "arrayField": ["项1", "项2"]
}
```

| 字段名       | 类型    | 是否必须 | 描述                           | 示例值           |
| ------------ | ------- | -------- | ------------------------------ | ---------------- |
| field1       | string  | 是       | 字段1的描述                    | "值1"            |
| field2       | string  | 否       | 字段2的描述                    | "值2"            |
| nestedObject | object  | 否       | 嵌套对象描述                   | { "subField1": "子值1" } |
| arrayField   | array   | 否       | 数组字段描述                   | ["项1", "项2"]   |

### 响应数据

#### 成功响应

状态码: `200000`

```json
{
  "code": 200000,
  "message": "操作成功",
  "data": {
    "id": 1,
    "field1": "值1",
    "field2": "值2",
    "createdAt": "2023-01-01T12:00:00.000Z",
    "updatedAt": "2023-01-01T12:00:00.000Z"
  },
  "path": "/资源路径",
  "timestamp": 1672574400
}
```

##### 响应字段说明

| 字段名    | 类型   | 描述                   |
| --------- | ------ | ---------------------- |
| id        | number | 资源唯一标识           |
| field1    | string | 字段1的描述            |
| field2    | string | 字段2的描述            |
| createdAt | string | 创建时间 (ISO格式)     |
| updatedAt | string | 最后更新时间 (ISO格式) |

### 示例

#### 请求示例

```bash
# 使用 curl 发送请求
curl -X POST \
  "https://api.example.com/资源路径" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -d '{
    "field1": "值1",
    "field2": "值2"
  }'
```

#### 响应示例

```json
{
  "code": 200000,
  "message": "操作成功",
  "data": {
    "id": 1,
    "field1": "值1",
    "field2": "值2",
    "createdAt": "2023-01-01T12:00:00.000Z",
    "updatedAt": "2023-01-01T12:00:00.000Z"
  },
  "path": "/资源路径",
  "timestamp": 1672574400
}
```

### 注意事项

- 该接口的特殊注意事项
- 可能的业务限制条件
- 与其他接口的关联关系
